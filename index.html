<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anik Fin - व्यवस्थापक दैनिक अहवाल (v5.3 - Mobile Scroll)</title>
    <!-- jsPDF Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF AutoTable Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
     <!-- html2canvas (Optional) -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* Base Styles */
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 15px; color: #333; font-size: 14px; }
        .container { max-width: 1200px; margin: 15px auto; background-color: #ffffff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); border: 1px solid #ddd; }
        #reportContentArea { background-color: #fff; }

        /* Header Image Styles */
        .header { margin-bottom: 20px; line-height: 0; text-align: center; }
        .header img { max-width: 100%; height: auto; display: inline-block; }

        h2.report-title { text-align: center; color: #333; font-weight: bold; margin-bottom: 15px; font-size: 1.4em; }

        /* Info Section Styles */
        .info-section { margin-bottom: 20px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;}
        .info-section label { font-weight: bold; min-width: 150px; text-align: right; padding-right: 10px; flex-shrink: 0;}
        .info-section input[type="text"], .info-section input[type="date"], .info-section select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; flex-grow: 1; min-width: 200px;}

        /* Table Styles */
        .report-table { width: 100%; border-collapse: collapse; margin-bottom: 0; /* Remove bottom margin as wrapper has it now */ font-size: 0.9em; table-layout: fixed; }
        .report-table th, .report-table td { border: 1px solid #a9c6e2; padding: 5px; text-align: center; vertical-align: middle; overflow-wrap: break-word; word-wrap: break-word; }
        .report-table thead { border-bottom: 2px solid #0056b3; }
        .report-table thead th { background-color: #e8f0fe; font-weight: bold; color: #003366; white-space: normal; padding: 6px 4px; position: relative; }
        .report-table thead tr:first-child th { border-bottom-width: 1.5px; border-bottom-color: #8baed1; }
        .report-table thead tr:last-child th { font-size: 0.85em; font-weight: bold; color: #335b85; background-color: #f5f9ff; padding: 3px 4px; border: none; border-right: 1px solid #a9c6e2 !important; border-top: 1px solid #a9c6e2 !important; }
        .report-table thead tr:last-child th:last-child { border-right: none !important; }
        .report-table thead th[rowspan="2"] { vertical-align: middle; border-bottom-width: 1px; border-bottom-color: #a9c6e2; }
        /* Column Widths */
        .report-table tbody td:first-child, .report-table thead th[rowspan="2"]:first-child { text-align: left; font-weight: bold; background-color: #f8f9fa; width: 7%; vertical-align: middle; }
        .report-table thead th[rowspan="2"]:last-child, .report-table tbody td:last-child { width: 7%; vertical-align: middle; }
        .report-table th:nth-child(2), .report-table td:nth-child(2), .report-table th:nth-child(4), .report-table td:nth-child(4), .report-table th:nth-child(6), .report-table td:nth-child(6), .report-table th:nth-child(8), .report-table td:nth-child(8) { width: 8%; }
        .report-table th:nth-child(3), .report-table td:nth-child(3), .report-table th:nth-child(5), .report-table td:nth-child(5), .report-table th:nth-child(7), .report-table td:nth-child(7), .report-table th:nth-child(9), .report-table td:nth-child(9) { width: 13%; }
        /* Text Input Styles */
        .report-table input[type="text"] { width: 95%; padding: 4px; border: 1px solid #ccc; border-radius: 3px; text-align: right; font-size: 1em; box-sizing: border-box; }
        .morning-plan-readonly input[type="text"] { background-color: #e9ecef; color: #495057; cursor: not-allowed; border-color: #ced4da; }

        h3.section-title { margin-top: 30px; margin-bottom: 10px; font-size: 1.2em; color: #0056b3; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        /* Analysis Section */
        .analysis-section { margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; background-color: #f9f9f9; }
        #analysisOutput { font-family: monospace; font-size: 0.95em; line-height: 1.6; color: #444; white-space: pre-wrap; max-height: 250px; overflow-y: auto; }
        #analysisOutput .analysis-point { margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px dotted #ccc; }
        #analysisOutput .analysis-point:last-child { border-bottom: none; margin-bottom: 0; }
        #analysisOutput .shortfall { color: #dc3545; }
        #analysisOutput .exceeded { color: #28a745; }
        /* Button Group, Output Area, Footer */
        .button-group { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .button-group button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; transition: background-color 0.3s ease; margin: 5px 10px; }
        .button-group button:hover { background-color: #0056b3; }
        .button-group button.pdf-button { background-color: #dc3545; }
        .button-group button.pdf-button:hover { background-color: #c82333; }
        .button-group button.whatsapp-button { background-color: #28a745; }
        .button-group button.whatsapp-button:hover { background-color: #218838; }
        #reportOutputContainer { margin-top: 30px; display: none; border: 1px dashed #ccc; padding: 15px; background: #f9f9f9;}
        #reportOutput { white-space: pre-wrap; font-family: monospace; font-size: 0.95em; }
        .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #777; }

        /* --- Mobile Styles --- */
        @media (max-width: 768px) {
            /* *** NEW: Make table wrappers scrollable *** */
            .table-scroll-wrapper {
                overflow-x: auto;   /* Enable horizontal scrolling */
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
                margin-bottom: 15px; /* Add space below scrolled table */
                 /* Optional: Add a subtle visual cue */
                 /* border-left: 3px solid rgba(0, 86, 179, 0.1); */
                 /* border-right: 3px solid rgba(0, 86, 179, 0.1); */
            }

            /* Make inputs usable within scrollable context */
            .report-table input[type="text"] {
                font-size: 16px !important; /* Still larger than default */
                min-height: 30px !important; /* Decent tap height */
                padding-top: 5px !important;
                padding-bottom: 5px !important;
                width: 98%; /* Fill cell nicely */
                box-sizing: border-box;
                border: 1px solid #999;
                max-width: none;
            }

            /* Reduce cell padding */
            .report-table th, .report-table td { padding: 3px 4px !important; font-size: 8pt; }
            .report-table tbody td:first-child { font-size: 8pt; } /* Keep consistent */

            /* Header text smaller */
            .report-table thead th { font-size: 0.85em; padding-top: 4px; padding-bottom: 4px; }
            .report-table thead tr:last-child th { font-size: 0.8em; padding: 2px 3px; }

            /* Info section adjustments */
            .info-section { gap: 5px; flex-direction: column; align-items: stretch; }
            .info-section label { min-width: unset; text-align: left; font-size: 0.9em; margin-bottom: 2px; }
            .info-section input, .info-section select { width: 100%; box-sizing: border-box; }
        }

        /* Print styles */
        @media print { /* ... Print styles ... */ }
        .pdf-morning-mode .evening-content-wrapper, .pdf-morning-mode .analysis-section { display: none !important; }

    </style>
</head>
<body>

    <div class="container">
        <div id="reportContentArea">
            <!-- IMAGE HEADER -->
            <div class="header" id="pdfHeaderImageContainer">
                 <img src="anik_header.jpg" id="headerImage" alt="Anik Financial Services Pvt. Ltd. Banner">
            </div>

            <h2 class="report-title">MANAGER DAILY REPORT</h2>

            <!-- Basic Info & Report Type Selection -->
            <div class="info-section"> <label for="managerName">NAME OF THE MANAGER:</label> <select id="managerName" name="managerName" required onchange="handleManagerChange()"> <option value="">-- Select Manager --</option> <option value="Balaji Shendge">Balaji Shendge</option> <option value="Atual Chilwant">Atual Chilwant</option> <option value="Bhikaji Jadhav">Bhikaji Jadhav</option> </select> </div>
            <div class="info-section"> <label for="reportDate">DATE OF REPORT:</label> <input type="date" id="reportDate" name="reportDate" required onchange="handleDateChange()"> </div>
             <div class="info-section" id="reportTypeSelector"> <label for="reportType">REPORT TYPE:</label> <select id="reportType" name="reportType" onchange="updateReportView()"> <option value="morning">Morning Plan Only</option> <option value="evening" selected>Evening Actuals & Analysis</option> </select> </div>


            <!-- Morning Plan Table -->
            <h3 class="section-title" id="morningPlanTitle">Morning Plan</h3>
            <!-- *** ADDED WRAPPER *** -->
            <div class="table-scroll-wrapper">
                <table class="report-table" id="morningPlanTable">
                     <thead> <tr> <th rowspan="2">Name of Staff</th> <th colspan="2">Today Recovery Target</th> <th colspan="2">Today Disbursement Target</th> <th colspan="2">Today Appraisal Target</th> <th colspan="2">Today OD / Past Due Target</th> <th rowspan="2">Today Group Meeting Nos</th> </tr> <tr> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> </tr> </thead>
                    <tbody> <!-- Rows generated by JS --> </tbody>
                </table>
            </div> <!-- *** END WRAPPER *** -->

            <!-- Wrapper for Evening Content -->
            <div id="eveningContentWrapper">
                <div class="evening-table-container">
                    <h3 class="section-title" id="eveningPlanTitle">Actual Done till Evening Plan</h3>
                     <!-- *** ADDED WRAPPER *** -->
                    <div class="table-scroll-wrapper">
                        <table class="report-table" id="eveningActualTable">
                             <thead> <tr> <th rowspan="2">Name of Staff</th> <th colspan="2">Today Recovery Target</th> <th colspan="2">Today Disbursement Target</th> <th colspan="2">Today Appraisal Target</th> <th colspan="2">Today OD / Past Due Target</th> <th rowspan="2">Today Group Meeting Nos</th> </tr> <tr> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> <th>No of Ac</th><th>Amount</th> </tr> </thead>
                            <tbody> <!-- Rows generated by JS --> </tbody>
                        </table>
                    </div> <!-- *** END WRAPPER *** -->
                </div>
                <div class="analysis-section" id="analysisSectionContainer">
                    <h3 class="section-title" id="analysisTitle">Analysis of Morning vs Evening (Auto-Generated)</h3>
                    <div id="analysisOutput"> <p style="color: #888;">Select a Manager and generate Evening report for analysis.</p> </div>
                </div>
            </div> <!-- End #eveningContentWrapper -->

        </div> <!-- End of #reportContentArea -->

        <!-- Buttons -->
        <div class="button-group">
            <button type="button" id="generateBtn" onclick="previewReport()">Generate Report</button>
            <button type="button" class="whatsapp-button" id="copyButton" onclick="copyReport()" style="display: none;">Copy Summary for WhatsApp</button>
            <button type="button" class="pdf-button" id="pdfButton" onclick="generatePdfWithAutoTable()">Download PDF</button>
        </div>

         <!-- Hidden Output Area -->
         <div id="reportOutputContainer" style="display: none;"> <h4>Generated Report Summary (for Copy/Paste):</h4> <div id="reportOutput"></div> </div>

        <div class="footer"> Software by Umesh Tonpe </div>
    </div> <!-- End .container -->

    <script>
        // --- All JavaScript functions remain identical to v5.2 ---
        const managerStaff = { "Balaji Shendge": [ "Mrs. Meera Pawar", "Mrs. Vandana Chilwant", "Mrs. Neeta Bhore", "Mrs. Swati Kawade", "Mrs. Gitangali Panchal", "Mrs. Savita Bangar", "Mrs.Shamal Potdar", "Mrs. Ashwini Shinde", "Mrs. Janabai Shikketod", "Mrs. Joti Shinde", "Mrs. Janhavi Shinde", "Miss. Vaishali Jadhav", "Mr. Vaibhav Chonde FX", "Mr. Vaibhav Shinde FX", "Mr. Prakash Todkar FX", "Mr. Darshan Nathjogi FX" ], "Atual Chilwant": [ "Mrs. Chaya Jogdand", "Mrs. Pramila Panchal", "Mrs.Savita Ausare", "Mrs.Usha Jagtap", "Mrs. Rajni Karale", "Mrs. Afreen Shaikh", "Mrs.Rajashri chavhan", "Mrs.Rohini Gapat", "Mrs. Kalpana Gunjal", "Mrs. Priyanka Deshmukh", "Mrs. Rekha Sapkal", "MR. Suraj Bhalerao FX", "Mr.Manoj Kshirsagar FX", "Mr. Rahim Shaikh FX", "Mr.Sushil Kumbhar FX" ], "Bhikaji Jadhav": [ "Mrs. Rohini Kothavale", "Mrs. Suvrnmala dorle", "Mrs. Nikita Chandanshive", "Mrs. Shakuntala Godge", "Mrs. Jayshree Kakde", "Mrs.Usha Mastud FX", "Mrs. Nanda Panchal FX", "Mrs. Pramila Rakh FX" ], "": [] };
        const metrics = [ { key: 'rec', name: 'Recovery', fields: [{key: 'ac', name: 'Ac'}, {key: 'amt', name: 'Amt'}] }, { key: 'disb', name: 'Disbursement', fields: [{key: 'ac', name: 'Ac'}, {key: 'amt', name: 'Amt'}] }, { key: 'appr', name: 'Appraisal', fields: [{key: 'ac', name: 'Ac'}, {key: 'amt', name: 'Amt'}] }, { key: 'od', name: 'OD/Past Due', fields: [{key: 'ac', name: 'Ac'}, {key: 'amt', name: 'Amt'}] }, { key: 'meet', name: 'Group Meeting', fields: [{key: 'nos', name: 'Nos'}] } ];
        function populateTables() { const selectedManager = document.getElementById('managerName').value; const currentStaffList = managerStaff[selectedManager] || []; const morningTbody = document.querySelector('#morningPlanTable tbody'); const eveningTbody = document.querySelector('#eveningActualTable tbody'); morningTbody.innerHTML = ''; eveningTbody.innerHTML = ''; currentStaffList.forEach(empName => { const mRow = morningTbody.insertRow(); const eRow = eveningTbody.insertRow(); mRow.insertCell().textContent = empName; eRow.insertCell().textContent = empName; const inputIdPrefix = empName.toLowerCase().replace(/^(mrs\.|mr\.|miss\.)\s*/, '').replace(/\s+fx$/, 'fx').replace(/[^a-z0-9]/gi, ''); metrics.forEach(metric => { metric.fields.forEach(field => { const mCell = mRow.insertCell(); const eCell = eRow.insertCell(); const fieldKeyLower = field.key.toLowerCase(); mCell.innerHTML = `<input type="text" inputmode="numeric" pattern="[0-9]*" id="m_${inputIdPrefix}_${metric.key}_${fieldKeyLower}" placeholder="${field.name}" required>`; eCell.innerHTML = `<input type="text" inputmode="numeric" pattern="[0-9]*" id="e_${inputIdPrefix}_${metric.key}_${fieldKeyLower}" placeholder="${field.name}" required>`; }); }); }); if (document.getElementById('reportType').value === 'evening') { loadMorningPlanData(); } setMorningFieldsReadonly(document.getElementById('reportType').value === 'evening'); }
        document.addEventListener('DOMContentLoaded', () => { document.getElementById('reportDate').valueAsDate = new Date(); handleManagerChange(); });
        function handleManagerChange() { populateTables(); clearGeneratedOutput(); updateReportView(); }
        function handleDateChange() { if (document.getElementById('reportType').value === 'evening') { loadMorningPlanData(); } clearGeneratedOutput(); }
        function updateReportView() { const reportType = document.getElementById('reportType').value; const eveningWrapper = document.getElementById('eveningContentWrapper'); const analysisOutputDiv = document.getElementById('analysisOutput'); const generateBtn = document.getElementById('generateBtn'); const isEvening = reportType === 'evening'; eveningWrapper.style.display = isEvening ? 'block' : 'none'; generateBtn.textContent = isEvening ? 'Generate Evening Report & Analysis' : 'Generate & Save Morning Plan'; setMorningFieldsReadonly(isEvening); if (isEvening) { analysisOutputDiv.innerHTML = '<p style="color: #888;">Analysis will appear here after generating the Evening report.</p>'; loadMorningPlanData(); } clearGeneratedOutput(); }
        function setMorningFieldsReadonly(isReadonly) { const morningTable = document.getElementById('morningPlanTable'); morningTable.querySelectorAll('input[type="text"]').forEach(input => { input.readOnly = isReadonly; }); if (isReadonly) { morningTable.classList.add('morning-plan-readonly'); } else { morningTable.classList.remove('morning-plan-readonly'); } }
        function clearGeneratedOutput() { document.getElementById('reportOutput').innerText = ''; document.getElementById('reportOutputContainer').style.display = 'none'; document.getElementById('copyButton').style.display = 'none'; }
        function getNumValue(id) { const element = document.getElementById(id); const value = Number(element ? element.value : 0); return isNaN(value) ? 0 : value; }
        function calculateAchievement(plan, actual) { plan = Number(plan); actual = Number(actual); if (isNaN(plan) || isNaN(actual)) return "N/A"; if (plan === 0) return actual > 0 ? "100%+" : "0%"; return `${Math.round((actual / plan) * 100)}%`; }
        function generateAnalysisPoints() { const selectedManager = document.getElementById('managerName').value; const currentStaffList = managerStaff[selectedManager] || []; const analysisPoints = []; currentStaffList.forEach(empName => { const inputIdPrefix = empName.toLowerCase().replace(/^(mrs\.|mr\.|miss\.)\s*/, '').replace(/\s+fx$/, 'fx').replace(/[^a-z0-9]/gi, ''); let hasShortfall = false; metrics.forEach(metric => { metric.fields.forEach(field => { const fieldKeyLower = field.key.toLowerCase(); const fullMetricKey = `${metric.key}_${fieldKeyLower}`; const mId = `m_${inputIdPrefix}_${fullMetricKey}`; const eId = `e_${inputIdPrefix}_${fullMetricKey}`; const mVal = getNumValue(mId); const eVal = getNumValue(eId); const difference = eVal - mVal; if (difference < 0) { if (!hasShortfall) { hasShortfall = true; } const pointText = `${empName}: ${metric.name} ${field.name} ${difference} (Plan: ${mVal}, Actual: ${eVal})`; analysisPoints.push({ text: pointText, type: 'shortfall' }); } }); }); if (hasShortfall) { analysisPoints.push({ text: '', type: 'spacer' }); } }); return analysisPoints; }
        function saveMorningPlanData() { const selectedDate = document.getElementById('reportDate').value; const selectedManager = document.getElementById('managerName').value; if (!selectedDate || !selectedManager) { return; } const currentStaffList = managerStaff[selectedManager] || []; const planData = {}; const storageKey = `morningPlan_${selectedManager}_${selectedDate}`; currentStaffList.forEach(empName => { const inputIdPrefix = empName.toLowerCase().replace(/^(mrs\.|mr\.|miss\.)\s*/, '').replace(/\s+fx$/, 'fx').replace(/[^a-z0-9]/gi, ''); metrics.forEach(metric => { metric.fields.forEach(field => { const fieldKeyLower = field.key.toLowerCase(); const fullMetricKey = `${metric.key}_${fieldKeyLower}`; const mId = `m_${inputIdPrefix}_${fullMetricKey}`; planData[mId] = getNumValue(mId); }); }); }); try { localStorage.setItem(storageKey, JSON.stringify(planData)); alert(`Morning plan saved for ${selectedDate}`); } catch (e) { console.error("Error saving to localStorage:", e); alert("Error saving morning plan."); } }
        function loadMorningPlanData() { const selectedDate = document.getElementById('reportDate').value; const selectedManager = document.getElementById('managerName').value; if (!selectedDate || !selectedManager) { return; } const storageKey = `morningPlan_${selectedManager}_${selectedDate}`; const savedData = localStorage.getItem(storageKey); const morningTable = document.getElementById('morningPlanTable'); if (savedData) { try { const planData = JSON.parse(savedData); let dataFound = false; const currentStaffList = managerStaff[selectedManager] || []; currentStaffList.forEach(empName => { const inputIdPrefix = empName.toLowerCase().replace(/^(mrs\.|mr\.|miss\.)\s*/, '').replace(/\s+fx$/, 'fx').replace(/[^a-z0-9]/gi, ''); metrics.forEach(metric => { metric.fields.forEach(field => { const fieldKeyLower = field.key.toLowerCase(); const fullMetricKey = `${metric.key}_${fieldKeyLower}`; const mId = `m_${inputIdPrefix}_${fullMetricKey}`; const inputElement = document.getElementById(mId); if (inputElement && planData.hasOwnProperty(mId)) { inputElement.value = planData[mId] || ''; dataFound = true; } else if (inputElement) { inputElement.value = ''; } }); }); }); if (!dataFound && Object.keys(planData).length > 0) { morningTable.querySelectorAll('input[type="text"]').forEach(input => input.value = ''); } } catch (e) { console.error("Error parsing saved morning data:", e); morningTable.querySelectorAll('input[type="text"]').forEach(input => input.value = ''); } } else { morningTable.querySelectorAll('input[type="text"]').forEach(input => input.value = ''); } }
        function previewReport() { /* ... Summary generation ... */ }
        function copyReport() { /* ... Copy logic ... */ }
        async function generatePdfWithAutoTable() { /* ... PDF generation with AutoTable ... */ }

    </script>

</body>
</html>
